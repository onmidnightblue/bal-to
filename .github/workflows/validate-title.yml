name: Validate PR Title

on:
  pull_request:
    types: [opened, edited, synchronize]

jobs:
  validate-title:
    runs-on: ubuntu-latest
    steps:
      - name: Validate PR Title Format
        uses: actions/github-script@v7
        with:
          github-token: ${{ secrets.GITHUB_TOKEN }}
          script: |
            const title = context.payload.pull_request.title.trim();
            
            const types = [
              'feat',
              'fix',
              'design',
              'chore',
              'test'
            ];

            const areas = [
              'admin',
              'auth',
              'calc',
              'mybalance'
            ];
            
            const choreRegex = /^chore\s-\s.+$/;
            const regex = new RegExp(`^(${types.join('|')}):(${areas.join('|')})\\s-\\s.+$`);

            if (!choreRegex.test(title) && !normalRegex.test(title)) {
              core.setFailed(
                `Please update the PR title to follow the 'type:area - description' format.` +
                `\n` +
                `* type: feat, fix, design, chore, test` +
                `\n` +
                `* area: admin, auth, calc, mybalance` +
                `\n` +
                `\n` +
                `Current title: ${title}`
              );
            }